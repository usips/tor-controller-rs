# Docker Compose configuration for Tor integration testing
#
# Usage:
#   docker compose up -d          # Start Tor
#   docker compose down           # Stop Tor
#   docker compose logs -f tor    # View logs
#
# The control port is exposed on localhost:9051

services:
  tor:
    build:
      context: ./docker
      dockerfile: Dockerfile
    container_name: tor-test
    ports:
      - "127.0.0.1:9050:9050"  # SOCKS proxy
      - "127.0.0.1:9051:9051"  # Control port
    volumes:
      # Persist Tor data for faster restarts (optional)
      - tor-data:/var/lib/tor
    healthcheck:
      test: ["CMD-SHELL", "echo 'PROTOCOLINFO 1' | nc -q 1 localhost 9051 | grep -q '250 OK'"]
      interval: 5s
      timeout: 5s
      retries: 12
      start_period: 30s
    restart: unless-stopped

volumes:
  tor-data:
